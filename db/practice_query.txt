app.get("/api/v1/dashboard/:deviceid", async (req, res) => {
  try { 
      const deviceId = req.params.deviceid;
      const query = `
      SELECT  
          slave_id,
          array_agg(reg_add ORDER BY reg_add) AS reg_addresses,
          array_agg(keys ORDER BY reg_add) AS keys
      FROM
          sensor_parameters
      WHERE
          device_id = $1
      GROUP BY
          slave_id
      `;
      
     const result = await db.query(query, [deviceId]);
      const sensorParamsQuery = await db.query(`
          SELECT
              sv.device_id AS "device_id",
              ${generateSelectClauses(result.rows)},
              MAX(TO_TIMESTAMP(sv.d_time, 'DD/MM/YY HH24:MI:SS')) AS "dtime"
          FROM
              sensor_value sv
          JOIN
              sensor_parameters sp ON sv.device_id = sp.device_id AND sv.slave_id = sp.slave_id AND sv.reg_add = sp.reg_add
          WHERE
              sv.device_id = $1
          GROUP BY
              sv.device_id, sv.d_time
          ORDER BY
              "dtime" DESC
          LIMIT 1;
      `, [deviceId]);

      res.status(200).json(sensorParamsQuery.rows);
  } catch (err) {
      console.error(err.message);
      res.status(500).json({ error: "Internal Server Error" });
  }
});
